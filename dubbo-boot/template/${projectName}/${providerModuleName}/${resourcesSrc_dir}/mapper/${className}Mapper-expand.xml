<#assign className = table.tableClassName>
<#assign classNameFirstLower = table.tableClassName?uncap_first>
<#assign primaryKey = table.primaryKey>
<#assign primaryKeyParameters = table.primaryKeyParameters>
<#assign primaryKeyParameterValues = table.primaryKeyParameterValues>
<#macro mapperEl value>${r"#{"}${value}}</#macro>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<!-- 存放手写的sql -->
<mapper namespace="${basePackage}.mapper.${className}Mapper">

    <resultMap id="ResultMapVo" extends="BaseModelMap" type="${basePackage}.vo.${className}Vo"></resultMap>

    <parameterMap id="SelectParameterMap" type="${basePackage}.parameter.${className}SelectParameter"></parameterMap>

    <#if table.hasPrimaryKey>
    <select id="getByPk" resultMap="ResultMapVo">
        SELECT DISTINCT
        <#list table.columns as column>
        `${table.tableName}`.`${column.columnName}`<#if column_has_next>,</#if>
        </#list>
        FROM
        `${table.tableName}`
        WHERE
        <#list primaryKey as column>
        <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl '${column.targetColumnNameFirstLower}'/>
        </#list>
    </select>
    </#if>

    <select id="findList" resultMap="ResultMapVo" parameterMap="SelectParameterMap">
        SELECT DISTINCT
        <#list table.columns as column>
        `${table.tableName}`.`${column.columnName}`<#if column_has_next>,</#if>
        </#list>
        FROM
        `${table.tableName}`
        <where>
        <#list table.columns as column>
            <#if column.ignoreSearch>
            <#elseif column.columnName == table.validStatusField.fieldName>
            <if test="${column.targetColumnNameFirstLower} != null">
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl column.targetColumnNameFirstLower/>
            </if>
            <#elseif (column.targetDataType == "Integer" || column.targetDataType == "Long" || column.targetDataType == "Short" || column.targetDataType == "Byte")>
            <if test="${column.targetColumnNameFirstLower} != null">
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl column.targetColumnNameFirstLower/>
            </if>
            <if test="${column.targetColumnNameFirstLower}List != null and ${column.targetColumnNameFirstLower}List.size() > 0">
                AND `${table.tableName}`.`${column.columnName}` in
                <foreach collection="${column.targetColumnNameFirstLower}List" item="item" open="(" close=")" separator=",">
                    ${r"#{item}"}
                </foreach>
            </if>
            <if test="${column.targetColumnNameFirstLower}Min != null">
                <![CDATA[
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` >= ${r"#{"}${column.targetColumnNameFirstLower}Min${r"}"}
                ]]>
            </if>
            <if test="${column.targetColumnNameFirstLower}Max != null">
                <![CDATA[
                AND `${table.tableName}`.`${column.columnName}` <= ${r"#{"}${column.targetColumnNameFirstLower}Max${r"}"}
                ]]>
            </if>
            <#elseif (column.targetDataType == "Date")>
            <if test="${column.targetColumnNameFirstLower} != null">
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl column.targetColumnNameFirstLower/>
            </if>
            <if test="${column.targetColumnNameFirstLower}Min != null">
                <![CDATA[
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` >= ${r"#{"}${column.targetColumnNameFirstLower}Min${r"}"}
                ]]>
            </if>
            <if test="${column.targetColumnNameFirstLower}Max != null">
                <![CDATA[
                AND `${table.tableName}`.`${column.columnName}` <= ${r"#{"}${column.targetColumnNameFirstLower}Max${r"}"}
                ]]>
            </if>
            <#elseif (column.targetDataType == "BigDecimal" || column.targetDataType == "Double" || column.targetDataType == "Float")>
            <if test="${column.targetColumnNameFirstLower}Min != null">
                <![CDATA[
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` >= ${r"#{"}${column.targetColumnNameFirstLower}Min${r"}"}
                ]]>
            </if>
            <if test="${column.targetColumnNameFirstLower}Max != null">
                <![CDATA[
                AND `${table.tableName}`.`${column.columnName}` <= ${r"#{"}${column.targetColumnNameFirstLower}Max${r"}"}
                ]]>
            </if>
            <#elseif (column.targetDataType == "String")>
            <if test="${column.targetColumnNameFirstLower} != null and ${column.targetColumnNameFirstLower} != ''">
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl column.targetColumnNameFirstLower/>
            </if>
            <if test="${column.targetColumnNameFirstLower}StartWith != null and ${column.targetColumnNameFirstLower}StartWith != ''">
                AND `${table.tableName}`.`${column.columnName}` LIKE concat(${r"#{"}${column.targetColumnNameFirstLower}StartWith${r"}"}, '%')
            </if>
            <if test="${column.targetColumnNameFirstLower}Like != null and ${column.targetColumnNameFirstLower}Like != ''">
                AND `${table.tableName}`.`${column.columnName}` LIKE concat('%', ${r"#{"}${column.targetColumnNameFirstLower}Like${r"}"}, '%')
            </if>
            <if test="${column.targetColumnNameFirstLower}List != null and ${column.targetColumnNameFirstLower}List.size() > 0">
                AND `${table.tableName}`.`${column.columnName}` in
                <foreach collection="${column.targetColumnNameFirstLower}List" item="item" open="(" close=")" separator=",">
                    ${r"#{item}"}
                </foreach>
            </if>
            <#else>
            <if test="${column.targetColumnNameFirstLower} != null">
                <#if (column_index > 0)>AND </#if>`${table.tableName}`.`${column.columnName}` = <@mapperEl column.targetColumnNameFirstLower/>
            </if>
            </#if>
        </#list>
        </where>
        <if test="orderBy != null and orderBy != ''">
            ORDER BY ${r"${orderBy}"}
        </if>
    </select>
</mapper>
